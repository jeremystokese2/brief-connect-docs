{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>TODO: Give a short introduction of your project. Let this section explain the objectives or the motivation behind this project. </p>"},{"location":"#getting-started","title":"Getting Started","text":"<p>TODO: Guide users through getting your code up and running on their own system. In this section you can talk about: 1.  Installation process 2.  Software dependencies 3.  Latest releases 4.  API references</p>"},{"location":"#build-and-test","title":"Build and Test","text":"<p>TODO: Describe and show how to build your code and run the tests. </p>"},{"location":"#contribute","title":"Contribute","text":"<p>TODO: Explain how other users and developers can contribute to make your code better. </p> <p>If you want to learn more about creating good readme files then refer the following guidelines. You can also seek inspiration from the below readme files: - ASP.NET Core - Visual Studio Code - Chakra Core</p>"},{"location":"Admin%20Guide/Adding-document-templates/","title":"Adding document templates","text":""},{"location":"Admin%20Guide/Adding-document-templates/#templates","title":"Templates","text":"<p>As a system administrator, you can prepare a number of templates and assign them to record types so that users creating and modifying corresponding records can create documents based on those templates.</p>"},{"location":"Admin%20Guide/Adding-document-templates/#adding-new-templates","title":"Adding new templates","text":"<p> To add a template:</p> <ul> <li>Go to the appropriate SharePoint site.</li> <li>Open the Document Templates library.</li> <li>Upload a new document.</li> <li>Select the new template and click the Details button in the action panel.</li> </ul> <p> * Apply the appropriate properties to the document.   * Ensure you select the record type(s) the document should appear in.   * Ensure you select 'Department' in Template Type.</p> <p></p>"},{"location":"Admin%20Guide/Adding-document-templates/#using-placeholders","title":"Using placeholders","text":"<p>The token replacement feature is used to display the values of the current record when generating a Word document from a template. Tokens can be used in the document body, header, and footer. All fields from the record are available for use.</p> <p>You can find the list of fields in the RecordFields table in Azure Storage. </p> <p>To create a proper token, use the following pattern: TOKENSTART.DisplayName.TOKENEND.</p>"},{"location":"Admin%20Guide/Adding-document-templates/#using-complex-type-placeholders","title":"Using complex type placeholders","text":"<p>Complex types are reduced to simple ones by declaring the desired field in the complex type. For example, for the User type, if you want to display the user's job title, you need to add a dot (.) after the field's internal name and then add the internal name of the property in your complex type.</p> <p>In this example, the token for the user's job title will look like TOKENSTART.DisplayName.JobTitle.TOKENEND.</p>"},{"location":"Admin%20Guide/Adding-document-templates/#example","title":"Example","text":""},{"location":"Admin%20Guide/Adding-document-templates/#known-issues","title":"Known Issues","text":"<p>Sometimes Word documents split text into different areas, and we cannot replace tokens because they appear similar to the example below:</p> <p><code>&lt;w:t&gt;{{&lt;/w:t&gt;&lt;/w:r&gt;&lt;w:proofErr w:type=\"spellStart\" /&gt;&lt;w:r w:rsidRPr=\"6B422EAB\" w:rsidR=\"03D9220A\"&gt;&lt;w:rPr&gt;&lt;w:rFonts w:ascii=\"Calibri\" w:hAnsi=\"Calibri\" w:eastAsia=\"Calibri\" w:cs=\"Calibri\" /&gt;&lt;w:b w:val=\"0\" /&gt;&lt;w:bCs w:val=\"0\" /&gt;&lt;w:i w:val=\"0\" /&gt;&lt;w:iCs w:val=\"0\" /&gt;&lt;w:caps w:val=\"0\" /&gt;&lt;w:smallCaps w:val=\"0\" /&gt;&lt;w:noProof w:val=\"0\" /&gt;&lt;w:color w:val=\"000000\" w:themeColor=\"text1\" w:themeTint=\"FF\" w:themeShade=\"FF\" /&gt;&lt;w:sz w:val=\"21\" /&gt;&lt;w:szCs w:val=\"21\" /&gt;&lt;w:lang w:val=\"en-US\" /&gt;&lt;/w:rPr&gt;&lt;w:t&gt;DecisionMaker.Mail&lt;/w:t&gt;&lt;/w:r&gt;&lt;w:proofErr w:type=\"spellEnd\" /&gt;&lt;w:r w:rsidRPr=\"6B422EAB\" w:rsidR=\"03D9220A\"&gt;&lt;w:rPr&gt;&lt;w:rFonts w:ascii=\"Calibri\" w:hAnsi=\"Calibri\" w:eastAsia=\"Calibri\" w:cs=\"Calibri\" /&gt;&lt;w:b w:val=\"0\" /&gt;&lt;w:bCs w:val=\"0\" /&gt;&lt;w:i w:val=\"0\" /&gt;&lt;w:iCs w:val=\"0\" /&gt;&lt;w:caps w:val=\"0\" /&gt;&lt;w:smallCaps w:val=\"0\" /&gt;&lt;w:noProof w:val=\"0\" /&gt;&lt;w:color w:val=\"000000\" w:themeColor=\"text1\" w:themeTint=\"FF\" w:themeShade=\"FF\" /&gt;&lt;w:sz w:val=\"21\" /&gt;&lt;w:szCs w:val=\"21\" /&gt;&lt;w:lang w:val=\"en-US\" /&gt;&lt;/w:rPr&gt;&lt;w:t&gt;}}&lt;/w:t&gt;</code></p> <p>The easiest way to avoid this issue is to copy and paste the entire token as plain text.</p> <p></p>"},{"location":"Admin%20Guide/Application-Settings/","title":"Application Settings","text":"<p>[[TOC]]</p>"},{"location":"Admin%20Guide/Application-Settings/#logo-configuration","title":"Logo Configuration","text":"<p>You can configure logos in the <code>/appSettings</code> page.</p> <p>To configure logos in Brief Connect, use the following specifications for the images. All images should be in <code>.png</code> format.</p> <ol> <li>Favicon </li> <li>Size: <code>192x192</code> pixels  </li> <li> <p>Format: <code>.png</code></p> </li> <li> <p>Navbar Logo </p> </li> <li>Recommended Size: <code>270px</code> wide x <code>96px</code> high  </li> <li> <p>Note: The app retains the original aspect ratio of the image and scales it to a height of <code>32px</code> in the navbar. Images wider than a <code>3:1</code> ratio may not display well on mobile devices.</p> </li> <li> <p>Primary Icon (Used in PDF Pack) </p> </li> <li>Max Width: <code>250px</code> </li> <li>Max Height: <code>95px</code> </li> <li>Note: The icon will scale to fit within these dimensions. </li> </ol> <p>These dimensions ensure optimal display across the application while maintaining aspect ratios and responsiveness.</p>"},{"location":"Admin%20Guide/Flow-Controls/","title":"Flow Controls","text":""},{"location":"Admin%20Guide/Flow-Controls/#controls","title":"Controls","text":"<p>In Brief Connect, there are four controls that can be set for each record.</p> <p>The controls are: * Withdrawn * Cancelled * No Further Action * On Hold</p>"},{"location":"Admin%20Guide/Flow-Controls/#applying-flags-to-a-record","title":"Applying flags to a record","text":"<p>If the user has a CanCancelRecord flag assigned to them, they can choose \"Cancel record\" from the 'I want to' dropdown.</p> <p>If the user has a CanTakeNoFurtherAction flag assigned to them, they can choose \"No further action\" from the 'I want to' dropdown.</p> <p>If the user has a CanWithdrawRecord flag assigned to them, they can choose \"Withdraw\" from the 'I want to' dropdown.</p> <p>If the user has a CanPlaceRecordOnHold flag assigned to them, they can choose \"Place record on hold\" from the 'I want to' dropdown.</p> <p></p>"},{"location":"Admin%20Guide/Flow-Controls/#removing-flags-from-a-record","title":"Removing flags from a record","text":"<p>When any of the controls are added to a record, the record is suspended without the possibility of changing record state.</p> <p>Administrators or users with the appropriate flag can remove the control from the record. Once they do that, the record is put back to the same state it was in before the control was applied.</p> <p></p> <p> </p> <p>System Administrators can define who can use these controls within the records. For more information see: Granting access to flow controls</p>"},{"location":"Admin%20Guide/Granting-access-to-flow-controls/","title":"Granting access to flow controls","text":""},{"location":"Admin%20Guide/Granting-access-to-flow-controls/#controls","title":"Controls","text":"<p>To learn about controls see: Flow Controls</p>"},{"location":"Admin%20Guide/Granting-access-to-flow-controls/#granting-permissions-for-using-controls","title":"Granting permissions for using controls","text":"<p>To grant permissions for users to use any of the controls, admins must go to the PermissionsSet table and create the appropriate permission set.</p> <p>The controls to be defined are:</p> <ul> <li>CanCancelRecord -&gt; for record cancellation</li> <li>CanTakeNoFurtherAction -&gt; for marking the record as no further action</li> <li>CanWithdrawRecord -&gt; for marking the record as withdrawn</li> <li>CanPlaceRecordOnHold -&gt; for placing the record on hold</li> </ul> <p></p> <p>Once the Permission Set is configured, the permissions need to be granted through the RoleAssignments table. </p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/","title":"How to manage Brief Connect permissions with Azure Storage Explorer","text":"<p>This guide explains how to configure permissions in Brief Connect using the Azure Storage Explorer application. Follow these steps to set up Permission Sets and Role Assignments to manage user access to records effectively.</p> <p>[[TOC]]</p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#before-you-start","title":"Before you start","text":"<p>Before you begin, ensure you have:</p> <ul> <li>Write access to the Storage Account in Azure where Brief Connect is deployed</li> <li>Azure Storage Explorer installed on your device</li> </ul>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#configure-permissions-in-brief-connect","title":"Configure Permissions in Brief Connect","text":""},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#1-open-azure-storage-explorer","title":"1. Open Azure Storage Explorer","text":"<p>Launch Azure Storage Explorer on your device.</p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#2-connect-to-your-storage-account","title":"2. Connect to Your Storage Account","text":"<ol> <li>In Azure Storage Explorer, click on the \"Connect\" button (plug icon) in the left sidebar</li> <li>Select \"Storage account or service\"</li> <li>Choose one of the following connection methods:</li> <li>Connection string: Select \"Connection string (key or SAS)\" and paste your storage account connection string</li> <li>Azure login: Select \"Azure\" and sign in with your Azure credentials</li> <li>Click \"Next\"</li> <li>Click \"Connect\"</li> </ol>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#3-navigate-to-tables","title":"3. Navigate to Tables","text":"<ol> <li>Expand your storage account in the left navigation pane</li> <li>Expand \"Tables\" to view all tables</li> </ol>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#4-manage-permission-sets-and-role-assignments","title":"4. Manage Permission Sets and Role Assignments","text":"<p>You will see a list of tables corresponding to your Brief Connect instance. The two relevant tables for configuring permissions are the PermissionSets Table and the RoleAssignments Table.</p> <p></p> <p>A Permission Set is a collection of individual permissions that control what actions a user can perform in Brief Connect. Each permission is a simple true/false (boolean) flag that either grants or denies access to a specific capability, such as viewing records or editing documents.</p> <p>Role Assignments are used to assign a Permission Set to users based on targeting rules. The targeting rules can filter users through mechanisms like Entra ID Group membership or specific email addresses, and can filter records through attributes like Record Type, Metadata values, or Workflow Stage.</p> <p>For example, you could create a Role Assignment that: - Grants the \"Read Only\" Permission Set - To all users in the \"Finance Team\" Entra ID Group  - For all records with Record Type \"Invoice\"</p> <p>This flexible rules engine allows System Administrators to create sophisticated permission schemes that match their organisation's business processes and compliance requirements.</p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#permission-sets-table","title":"Permission Sets Table","text":"<p>Permission Sets are stored in the Permission Sets table, where administrators can create and modify them based on their organisation's needs. When a user is assigned a Permission Set through Role Assignments, Brief Connect checks these individual permissions whenever the user attempts to perform an action.</p> <p>For example, a \"Read Only\" Permission Set might have viewing permissions for a record enabled but editing permissions disabled, while a \"Full Access\" Permission Set might enable all permissions. </p> <p>The Permission Sets table contains the following individual permissions that can be enabled or disabled:</p> Permission Description CanViewRecord Controls whether the user can view the basic record information (i.e. open the details page for a Record) CanEditRecordMetadata Controls whether the user can edit record metadata (note: this includes all fields on the Record Details page. Brief Connect does not currently support limiting which fields can be edited - or 'field-level' permissions) CanViewAllDocuments Controls whether the user can view all documents on a record CanAddDocuments Controls whether the user can add new documents CanEditDocuments Controls whether the user can edit documents (editing record content, as well as renaming and reordering documents) CanDeleteDocuments Controls whether the user can delete documents CanUploadSignedDocuments Controls whether the user can upload signed versions of documents CanUploadSupportingDocuments Controls whether the user can upload supporting documentation (note: this is a useful flag if you want to allow users to upload documents to only the Supporting Documents category. If this is your intention, then the user must not inherit the 'CanAddDocuments' permission as it will override this flag) CanCreateBrief Controls whether the user can create new records - this flag must be paired with a Role Assignment that targets permissions on a record type-basis (e.g. activates on a 'Ministerial Correspondence' record type) CanCancelRecord Controls whether the user can cancel records CanPlaceRecordOnHold Controls whether the user can place records on hold CanTakeNoFurtherAction Controls whether the user can mark records as requiring no further action CanWithdrawRecord Controls whether the user can withdraw records <p>If a property/field hasn't be defined for a Permission Set, it will inherit a default value of <code>'false'</code>.</p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#add-a-new-permission-set","title":"Add a New Permission Set","text":"<ol> <li>Click the + Add entity button at the top of the PermissionSets table.</li> </ol> <ol> <li>Fill in the required fields:</li> <li>PartitionKey: Set this to <code>'Basic'</code>.</li> <li>RowKey: Enter a name of your choice for the permission set, e.g., <code>'ReadOnly'</code>.</li> </ol> <ol> <li> <p>Assign <code>'true'</code> or <code>'false'</code> values to each property based on the desired permissions. Ensure the Type field remains set to <code>'Boolean'</code> for all properties.</p> </li> <li> <p>After configuring the permission set, click Insert to save. To edit an existing permission set, double-click or right-click and select Edit.</p> </li> </ol>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#role-assignments-table","title":"Role Assignments Table","text":"<p>The Role Assignments table allows you to create and modify roles linked to specific permission sets. A Role Assignment is like a collection of rules that combine together to determine the subset of users that should inherit a given Permission Set. </p> <p>Each role assignment has the following properties:</p> Property Description Mandatory Examples Default Value Field Type PartitionKey Accepts a comma-separated list of record types. The RoleAssignment will only apply to Record Types specified in this field. This is the same name as the Content Type within SharePoint Online for the Record Type.Alternatively, set the value to 'All' to apply the role assignment to all record types Yes Cabinet Submission (CSUB),Correspondence,Ministerial Correspondence (CMIN) None String RowKey A unique identifier for the Role Assignmnet. Commonly used to summarise the role assignment for clarity Yes COR - AO - EDITCOR - LA - READCSUB - Full AccessBMIN - Full AccessBSEC - Full Access None String Description A detailed description of the role assignment for clarity No Provides edit access for Accountable Officers on Correspondence records. This helps identify the purpose when reviewing role assignments later. None String PermissionSet The name of a single permission set from the PermissionSets table to be allocated to the role. Each role assignment can only have one permission set. Yes ReadOnly None String RecordRoleNames Accepts a comma-separated list of record role display names that this assignment applies to, or 'All' to apply the role assignment to all roles. Must exactly match the role names configured in the content type settings for the record type(s). Also see Special Rules for RecordRoleAssignments No Accountable Officer,Lead Author All String Stages Accepts the name of the workflow stages this assignment applies to, or 'All' to apply the role assignment to all stages. Must exactly match the stage names configured in the workflow settings for the record type(s) No None All String AADGroupNames A comma-separated list of Azure AD groups this assignment applies to No SG_Finance_Team None String <p>Note: The fields ForFieldValues and Organisations are to be updated as per your organization's requirements.</p> <p>Each property within a Role Assignment further refines the scope of the Role Assignment.</p> <p>For example, a Role Assignment might be configured to grant the \"Read Only\" Permission Set to all users in the \"Finance Team\" for all \"Correspondence\" records. You would achieve this by setting the following values:</p> <ul> <li>PartitionKey: <code>'Correspondence (Cor)'</code></li> <li>RowKey: <code>'COR - Full Access'</code></li> <li>Description: <code>'Grants read only access to all Correspondence records for the Finance Team'</code></li> <li>PermissionSet: <code>'ReadOnly'</code></li> <li>AADGroupNames: <code>'SG_Finance_Team'</code></li> </ul> <p>This Role Assignment will be inherited by all users in the \"Finance Team\" Entra ID Group for all \"Correspondence\" records. The \"ReadOnly\" Permission Set would apply to all workflow stages of the Correspondence record.</p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#add-a-new-role-assignment","title":"Add a New Role Assignment","text":"<ol> <li>Click the + Add entity button above the RoleAssignments table.</li> </ol> <ol> <li>Provide the required details for the role assignment, including PartitionKey, RowKey, Description, and select the appropriate PermissionSet.</li> </ol> <p>{Assumption: Additional fields such as RecordRoleNames, Stages, and AADGroupNames should be filled based on your organisation's specific roles and requirements.}</p> <p></p> <ol> <li>After entering all necessary information, click Insert to save the new role assignment.</li> </ol>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#permission-recalculation","title":"Permission Recalculation","text":"<p>Each time a user requests a record (i.e.: via opening the Record Details page), Brief Connect will recalculate the user's permissions based on the Role Assignments they are assigned to. This ensures that users can only access records that they are explicitly assigned to and perform actions they are explicitly granted permission to.</p>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#multiple-role-assignments","title":"Multiple Role Assignments","text":"<p>Brief Connect supports multiple Role Assignments for a given user. This allows you to create complex permission schemes that combine multiple Permission Sets and targeting rules.</p> <p>All Permission Sets assigned to a user are combined together, with the most permissive settings taking precedence. For example, if a user inherits two Role Assignments:</p> <ul> <li>One that grants \"Full Access\" permissions with the following flags:</li> <li>CanViewRecord = true</li> <li>CanEditRecordMetadata = true</li> <li>CanViewAllDocuments = true</li> <li>CanAddDocuments = true</li> <li>CanEditDocuments = true</li> <li>CanDeleteDocuments = true</li> <li>One that grants \"Read Only\" permissions with the following flags:</li> <li>CanViewRecord = true</li> </ul> <p>The total permissions granted to the user will be:</p> <ul> <li>CanViewRecord = true</li> <li>CanEditRecordMetadata = true</li> <li>CanViewAllDocuments = true</li> <li>CanAddDocuments = true</li> <li>CanEditDocuments = true</li> <li>CanDeleteDocuments = true</li> </ul>"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#special-rules-for-recordroleassignments","title":"Special Rules for RecordRoleAssignments","text":"<p>The RecordRoleNames field is used to specify which roles within a record type should inherit the Permission Set. In addition to supporting specific role names and the value 'All', it also supports a special set of values that can be used to target permissions at roles in a more dynamic way.</p> <p>The special values are:</p> Description Value Named users from department roles (i.e. not the Decision stage roles), including the Initiator role DepartmentInclInitiator Named users from department roles (i.e. not the Decision stage roles), but excluding the Initiator role DepartmentExclInitiator Named users from roles in the Decision stage Decision Named users from roles in the Decision stage, but excluding the DLO role DecisionExclDLO Named users from all roles including aux roles AllIncludingViewOnlyCreatedByEtc Named users from initiator role Initiator Named users from DLO role DLO Users who are actively assigned a task within the workflow for the record(e.g. if John Doe is an Accountable Officer on a Correspondence record, and is assigned the task of \"Prepare first draft\", by setting this value to \"AssignedTo\", the \"Read Only\" Permission Set will be granted to John Doe for the duration of the task. The Lead Author role can also be reassigned to another user, in which case the \"Read Only\" Permission Set will no longer be granted to John Doe) AssignedTo"},{"location":"Admin%20Guide/How-to-manage-Brief-Connect-permissions-with-Azure-Storage-Explorer/#see-also","title":"See also","text":"<ul> <li>Azure Storage Explorer - For managing Role Assignments and Permission Sets directly in Azure Storage Tables</li> <li>Azure Active Directory Groups - For managing AAD Groups referenced in Role Assignments</li> </ul>"},{"location":"Admin%20Guide/Managing-proxies/","title":"Managing proxies","text":""},{"location":"Admin%20Guide/Managing-proxies/#proxies","title":"Proxies","text":"<p>When a proxy is assigned to a user, they can filter the dashboard to their executives view and complete actions on their behalf.</p>"},{"location":"Admin%20Guide/Managing-proxies/#managing-proxies","title":"Managing proxies","text":"<p>To find a list of proxies: - Go to the Brief Connect SharePoint Online site - Go to the Site Contents - Go to the \u2018Proxy Users\u2019 list - In the list you can see all the users who have proxies assigned.</p>"},{"location":"Admin%20Guide/Managing-proxies/#adding-a-new-proxy","title":"Adding a new Proxy","text":"<ul> <li>Go to the \u2018Proxy Users\u2019 list</li> <li>Click '+ Add new item'</li> </ul> <p> - Select a user and choose their proxy - Add an expiry date to the proxy assignment. On this date, the proxy will be removed</p> <p> - Click Save</p>"},{"location":"Admin%20Guide/Managing-proxies/#editing-a-proxy","title":"Editing a Proxy","text":"<ul> <li>Go to the \u2018Proxy Users\u2019 list</li> <li>Select the line item that you want to edit</li> <li>Click Edit in the action bar</li> </ul>"},{"location":"Admin%20Guide/Managing-proxies/#deleting-a-proxy","title":"Deleting a Proxy","text":"<ul> <li>Go to the \u2018Proxy Users\u2019 list</li> <li>Select the line item that you want to delete</li> <li>Click Delete in the action bar</li> </ul>"},{"location":"Admin%20Guide/Reviewing-logs-in-App-Insights/","title":"Reviewing logs in App Insights","text":"<p>App Insights is a service that provides monitoring and analytics for our app. It helps us track the performance, availability, usage, and errors of our app. We can use App Insights to debug our app by following these steps:</p> <ol> <li>Log in to the Azure portal and navigate to the resource group BriefConnect-DEV (or other target environments).</li> <li>Select the App Insights resource BriefConnectDEV-AI from the list of resources.</li> <li>On the overview page, you can see various metrics and charts that show the health and activity of our app. You can also customize the dashboard by adding or removing tiles, changing the time range, or applying filters.</li> <li>To view the detailed logs of our app, click on Logs from the left menu. This will open a query editor where you can write and run queries using the Kusto query language.</li> <li>You can use the traces table to view the regular log records of our app. For example, you can run this query to see the traces from the last 24 hours:</li> </ol> <pre><code>traces\n| where timestamp &gt; ago(24h)\n| order by timestamp desc\n</code></pre> <ol> <li>You can use the exceptions table to view the exceptions that occurred in our app. For example, you can run this query to see the exceptions from the last 24 hours:</li> </ol> <pre><code>exceptions\n| where timestamp &gt; ago(24h)\n| order by timestamp desc\n</code></pre> <p></p> <ol> <li>You can also use other tables and functions to query different aspects of our app, such as requests, dependencies, custom events, availability results, etc. You can find more information about the schema and syntax of App Insights queries here: https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/log-query-overview</li> <li>To debug a specific issue or scenario, you can use the search feature to find and filter relevant events across all tables. You can also use the application map to visualize the dependencies and failures of our app. You can find more information about how to use App Insights for troubleshooting here: https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-troubleshoot-faq</li> </ol>"},{"location":"Deployment%20Guide/Home/","title":"Home","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/1.-Executive-Summary/","title":"1. Executive Summary","text":"<p>BMCP is the briefing note and cabinet submission management. BMCP is based on the ABC application, originally developed by Engage Squared.</p> <p>The following deployment guide details how a new environment is established, the use of DevOps pipelines to deploy updates, and manual tasks that are required to finalise deployment activity.</p> <p>Brief resources summary for each environment:</p> <ul> <li>1 SharePoint site collection</li> <li>3 AAD Apps (Service principals)</li> <li>1 Azure Resource group containing all resources.</li> <li>1 Service accounts with Outlook license</li> <li>1 Personal Teams app</li> <li>A set of AAD security groups following environment specific naming convention</li> <li>A set of CI/CD Pipelines in Azure DevOps</li> </ul> <p>All from above should be unique for every environment, except AAD apps, which can be re-used for non-production environments. Make sure you\u2019re using environment-specific naming rules for all the resources provisioned in this guide.</p> <p>More details in related sections of this document.</p> <p>1.1 Note on naming:</p> <p>It\u2019s nice to have a name of the environment in all related resources. For example, if a UAT environment is deployed, then add \u2018uat\u2019 prefix or postfixes to resource groups, sites, AAD groups, AAD apps, etc. It should be combined with any naming convention rules you have.</p>"},{"location":"Deployment%20Guide/Home/10-Power-BI-deployment/","title":"10 Power BI deployment","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/","title":"2. Azure Resource Deployment","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/3-Add-application-permissions-on-sites/","title":"3 Add application permissions on sites","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/4-Setup-email-notifications-whitelist-%28optional%29/","title":"4 Setup email notifications whitelist (optional)","text":"<p>The following instruction is to limit users who can receive notifications from BMCP. It is helpful in situations when a non-production environment deployed to production M365 tenant, and you don\u2019t want users, who is not in the target group, receive notifications.</p> <p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/","title":"5 Deploy Office Resources","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/6-Deploy-Server%252DSide-Code/","title":"6 Deploy Server%2DSide Code","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/","title":"7 Deploy Client%2DSide Code","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/8-Teams-Application/","title":"8 Teams Application","text":"<p>[[TOSP]]</p>"},{"location":"Deployment%20Guide/Home/9-Post-deployment-steps/","title":"9 Post deployment steps","text":"<p>Using Admin/User guide, validate/set-up next areas for the new environment: * Update Header Links using Header Links list on the SharePoint site. * Setup correct proxies for users using Proxy Users list. * Update Public Holidays in related list. * Add/update document templates in Document Templates library * Update user\u2019s membership:    * Site admins    * \u201cAll users\u201d group * Apply an appropriate disposition policy on the personal storage library   * Activate site collection feature \u201cLibrary and Folder Based Retention\u201d   * Apply t+3d for Document  * Add placeholder document template \u201cEmpty Template\u201d for all record types (select all 2nd level terms) in Document Templates library, including the PPO advice coversheet (2 empty documents, with the same metadata, but Template Type field)</p>"},{"location":"Deployment%20Guide/Home/10-Power-BI-deployment/10.1-Pre%252Drequisites/","title":"10.1 Pre%2Drequisites","text":"<ul> <li>A service account with Power PI license</li> <li>Power BI desktop (https://powerbi.microsoft.com/en-us/downloads/)</li> </ul>"},{"location":"Deployment%20Guide/Home/10-Power-BI-deployment/10.2-Getting-connection-data/","title":"10.2 Getting connection data","text":"<p>To create Power BI dataflow, dataset, and report, we need to get an access key to the Azure tables. To do this, we need to log in to the Azure Portal where BMCP application is deployed and navigate to the appropriate resource group. Below are the Steps with an example on a Dev environment.</p> <ol> <li>Open BMCP app resource group in Azure</li> <li>Open Storage account\u00a0resource</li> <li>Open \"Access keys\" on left menu</li> <li>Copy \"Storage account name\" and \"key1\"</li> </ol> <p></p>"},{"location":"Deployment%20Guide/Home/10-Power-BI-deployment/10.3-Setting-up-Power-BI/","title":"10.3 Setting up Power BI","text":"<ol> <li>Open\u00a0https://app.powerbi.com/home\u00a0\u00a0with Service account</li> <li>Click on \"Workspaces\" and create new workspace. Name it with environment related name, for example BMCP \u2013 [Environment] Workspace. </li> <li>Create a new Dataflow </li> <li>Click on \"Add new tables\" </li> <li>Choose \"Azure tables\" data source </li> <li>Paste \"Storage account name\" and \"key1\" from section 10.2 of this deployment guide and click \"Next\" </li> <li>Select \"RecordsDataForPowerBI\" table from the table list and click \"Transform data\" </li> <li>Click on \"Expand\" icon in \"Content\" column header and select all column. Then press \"OK\". Then \u201cSave &amp; close\u201d. Set \u201cBMCP \u2013 [Environment] Dataflow\u201d name and save it. </li> <li>Close dataflow view </li> <li>Click on \"Refresh now\" button </li> <li>Choose your dataflow and click on \"Schedule refresh\" icon </li> <li>Set Schedule and click \"Apply\" </li> </ol>"},{"location":"Deployment%20Guide/Home/10-Power-BI-deployment/10.4-Create-Report-%2B-dataset/","title":"10.4 Create Report + dataset","text":"<ol> <li>Open \"Power BI desktop\" with Service account that has access to Workspace and Dataflow</li> <li>Click on \"Get data\" in ribbon and select \"Dataflows\"</li> <li>Select previously created dataflow and click \"Load\" button. </li> <li>Build sample report: </li> <li>Save and publish the report </li> <li>Now Report + Dataset can be found in Power BI web app. It can be shared with business users who should have access to it. </li> </ol>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.1-Note-on-Authorisation/","title":"2.1 Note on Authorisation","text":"<p>The following deployment steps are written assuming that the release is executed as a service principal (AAD App). Further, it is assumed that authentication is managed via an Azure DevOps Service Connection. This is the recommended practice. However, the script supports providing clientId, clientSecret, and tenantId as parameters if the use of a Service Connection is undesirable for any reason. </p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.10-Create-AAD-groups/","title":"2.10 Create AAD groups","text":"<p>It is recommended to use the same naming conventions for all AAD groups for the given environment. Try to use same prefixes and postfix values for them. For example: SG-BMCP-[GroupName]-UAT. Use the same values that will be specified in SecurityGroupsPrefix and SecurityGroupsPostfix values in Application config later.</p> <p>Create 2 AAD Groups: * Group for admins with \u201cAppAdministrators\u201d name * Group for users who has access to the app with \u201cAllUsers\u201d name.</p> <p>Example group naming template: * \u201cAC-DPC-ABCApp-\u201c \u2013 Prefix * \u201c-G\u201d - Postfix</p> <p></p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.11-Org-hierarchy/","title":"2.11 Org hierarchy","text":"<p>BMCP app loads Org Structure from table in Azure Storage.</p> <p>Table Name: organization</p> <p>Fields: * PartitionKey: Parent Organization ID. If it is root organization, then it is \"Root\". * RowKey: Organization ID. * Name: Organization Name.</p> <p>Create a table and fill it with the necessary data.</p> <p>Note: The application supports 4 levels of nesting.</p> <p>Example:</p> <p></p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.12-Update-AAD-App-Reply-URLs/","title":"2.12 Update AAD App Reply URLs","text":"<p>[[TOC]]</p> <p>When the new Azure resources created, update AAD apps with resource\u2019s actual values, that provisioned into the Azure resource group by the release pipeline. Open Azure Portal and open the resource group there to see the resources provisioned.</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.12-Update-AAD-App-Reply-URLs/#2121-server-app","title":"2.12.1 Server App","text":"<p>Add Reply URI: * Click 'Authentication' * Click 'Add a platform' * Platform: Web * Find the name of the Azure Function in the list of azure resources created previously, with -pfa postfix in it. * URI: <code>https://&lt;PFA FUNCTION-APP-NAME&gt;.azurewebsites.net/.auth/login/aad/callback</code> * Check \"ID tokens\" * Set \"Allow public client flows\" to TRUE</p> <p>Expose an API:</p> <ul> <li>Click \"Expose an API\" in the side panel.</li> <li>Find the name of the Endpoint resource in the list of azure resources created previously, with -CDNe postfix in it.</li> <li>Edit application ID URI to <code>api://&lt;CDN-ENDPOINT-NAME&gt;.azureedge.net/&lt;Server AAD App ID&gt;</code></li> <li>Click 'Add a scope'</li> <li>If prompted to provide an Application ID URI, accept the default (can provide a friendly name in production environment)</li> <li>Scope name: <code>access_as_user</code></li> <li>Who can consent: Admins only</li> <li>Admin consent display name: Make request to the [ENVPREFIX] BMCP API</li> <li>Admin consent description: Allow users to make requests to the [ENV PREFIX] BMCP API</li> <li>Save</li> </ul> <p>Approve Client Applications</p> <ul> <li>Click 'Add a client application'</li> <li>Client ID: Application Id of the Client App Registration from above</li> <li>Check the authorised scope is selected, click \"Add application\".</li> <li>Repeat 3 previous steps for app ids: 5e3ce6c0-2b1f-4285-8d4b-75ee78787346, 1fec8e78-bce4-4aaf-ab1b-5451cc387264 (Microsoft Teams Desktop/Mobile app and Teams Web app)</li> <li>Save</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.12-Update-AAD-App-Reply-URLs/#2121-client-app","title":"2.12.1\u00a0Client App","text":"<p>Add Reply URIs: * Click 'Authentication' * Click 'Add a platform' * Platform: SPA * URI: Get the 'Endpoint hostname' from the CDN Endpoint overview (e.g. <code>https://&lt;CDN-ENDPOINT-NAME&gt;.azureedge.net/</code>) * URI: Get the 'Origin hostname' from the CDN Endpoint overview (e.g. <code>https://&lt;STORAGE-ACCOUNT-NAME&gt;.z26.web.core.windows.net/</code>) * URI:\u00a0https://localhost:3000\u00a0\u00a0(for non-prod environments only, to be able to run dev server on them) * Check \"ID tokens\"</p> <p>Update API Permissions: * Click \"API Permissions\" in the side panel * Click 'Add a permission' * Select the 'My APIs' tab * Select the BMCP Server app registration * Select <code>access_as_user</code>, and add it * Click the 'Grant Admin Consent' button and grant consent</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.13-Final-Function-App-Configuration/","title":"2.13 Final Function App Configuration","text":"<p>[[TOC]]</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.13-Final-Function-App-Configuration/#2131-configure-key-vault","title":"2.13.1\u00a0Configure Key Vault","text":"<p>Configure certificate</p> <ol> <li>Navigate to the Key Vault</li> <li>Click on 'Access Policies' and provide yourself with 'Get/Set' certificate permissions, Save</li> <li>Upload the .pfx certificate file that matches the .cer certificate file that was added the server app above to the Key Vault</li> <li>Copy the value (Example value: <code>@Microsoft.KeyVault(SecretUri=uri to the cert)</code> ) (note that the 'secret reference' not 'certificate reference' for the certificate in key vault should be used here). To get the URI click on the Thumbprint, then current version</li> </ol> <p>Add API WebApp to 'Access Policies'</p> <ol> <li>Navigate to the Key Vault</li> <li>Click on 'Access Policies' and provide \"API WebApp\" with 'Get/List' certificate and Secret permissions, Save <p></p> </li> </ol>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.13-Final-Function-App-Configuration/#2132-update-app-settings","title":"2.13.2\u00a0Update App settings","text":"<p>Some function app settings have been set automatically by the pipeline but a few remain.</p> <p>For PFA Function App, click 'Configuration' in the side panel.</p> <p>Create or update if necessary for each of the following:</p> <ul> <li>ClientId: AAD Server App ID</li> <li>ClientCertificate: Key Value reference from the above</li> <li>SupportedTenantIds: Brief Connect Tenant ID (GUID)</li> <li>DisableAllNotifications: Set to 'true' initially when in a production environment to avoid accidentally sending notifications to users (emails and teams activities). Update to 'false' to allow notifications to be sent to users.</li> <li>DisableGuestUserSearch: 'false'</li> <li>SecurityGroupsPrefix: \"AC-BMCPApp-\" for example, or other prefix value for AAD groups, can't be empty.</li> <li>SecurityGroupsPostfix: \"-G\" or other postfix value for AAD groups (environment name), can't be empty</li> <li>AuthorizedGroupName: AAD group for users who have access to the system. Use [SecurityGroupsPrefix]-Users-[SecurityGroupsPostfix] group, which should be created by \"DeployAadGroups.ps1\". The group also has to be added to SharePoint site visitors.</li> <li>AuthorizedGroupId: Id of the group AuthorizedGroupName from above.</li> <li>FUNCTIONS_WORKER_RUNTIME: dotnet</li> <li>FUNCTIONS_EXTENSION_VERSION: ~4</li> <li>FUNCTIONS_INPROC_NET8_ENABLED: 1</li> <li>SiteUrl: Url of the SharePoint site collection</li> <li>EmailNotificationsServiceAccount: UPN of a service account for sending email notifications</li> <li>TopHeaderBannerText \u2013 Text to show to all users of the app on top of the header, for example to clearly identify that it is a non-production environment</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.13-Final-Function-App-Configuration/#2133-authentication-settings","title":"2.13.3 Authentication settings","text":"<p>Go to the app authentication setting, and edit settings to be the same as on the screenshot below:</p> <p></p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.13-Final-Function-App-Configuration/#2134-net-version","title":"2.13.4 .NET Version","text":"<p>Ensure \".NET Version\" setting for PFA Function App</p> <p></p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.13-Final-Function-App-Configuration/#2135-update-app-settings-for-api-web-app","title":"2.13.5\u00a0Update App settings for API Web App","text":"<p>Copy following Environment variables from PFA Azure function into API Web App:</p> <ul> <li>\"AppUrl\"</li> <li>\"AuthorizedGroupId\"</li> <li>\"AuthorizedGroupName\"</li> <li>\"AzureWebJobsStorage\"</li> <li>\"ClientCertificate\"</li> <li>\"ClientId\",\"CosmosDbConnectionString\"</li> <li>\"DisableAllNotifications\"</li> <li>\"DisableGuestUserSearch\"</li> <li>\"EmailNotificationsServiceAccount\"</li> <li>\"RedisCacheConnectionString\"</li> <li>\"Scope\"</li> <li>\"SecurityGroupsPostfix\"</li> <li>\"SecurityGroupsPrefix\"</li> <li>\"SiteUrl\"</li> <li>\"StorageAccountConnectionString\"</li> <li>\"SupportedTenantIds\"</li> <li>\"TeamsAppId\"</li> <li>\"TenantId\"</li> </ul> <p></p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.14-Redis-cache-setup/","title":"2.14 Redis cache setup","text":"<p>By default, Redis cache instance provisioned in Basic Tier - C0 size, as it can be upscaled, but not downscaled after it\u2019s created.</p> <p>To update the size, navigate to \u201cAzure Cache for Redis\u201d resource instance for the selected environment, open \u201cScale\u201d for it:</p> <p></p> <p>Change Tier and size to the next one: * Leave Basic Tier, C0 (250MB, no SLA) size for non-production environments, to save costs as SLA is not required there. * Change to Standard Tier, C1 (1GB, SLA 99.9%) size for production environments. If it can\u2019t be changed to Standard C1 from Basic C0 directly, change it to Standard C0 first, and then to Standard C1</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.15-Guest-access/","title":"2.15 Guest access","text":"<ol> <li>Sign into the Azure portal with Global Administrator permissions.</li> <li>Browse to Azure Active Directory &gt; User settings.</li> <li>Under External users, select Manage external collaboration settings.</li> <li>On the External collaboration settings page, select \u201cGuest users have limited access to properties and memberships of directory objects\u201d</li> </ol>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.2-Note-of-pre%252Drequisites/","title":"2.2 Note of pre%2Drequisites","text":"<ul> <li>Tenant admin account to create App registrations, grant admin consent, create AAD groups, update AAD user profiles, etc.</li> <li>Service account with Outlook license (for sending BMCP email notifications)</li> <li>A service account with Power BI license</li> <li>Url of the created SharePoint site collection (Communication Site) associated with current environment (Or a SharePoint Admin account to create one).</li> <li>Azure Subscription (same subscription can be shared for Board Connect and BMCP resources) should have next resource types registered (details about registering resource types here: https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types):</li> <li>Microsoft.Cache</li> <li>Microsoft.Cdn</li> <li>Microsoft.DocumentDB</li> <li>microsoft.insights</li> <li>Microsoft.KeyVault</li> <li>Microsoft.Network</li> <li>Microsoft.Storage</li> <li>Microsoft.Web</li> <li>microsoft.alertsmanagement</li> <li>Microsoft.DocumentDB</li> <li>Created Azure resource group, associated with the subscription above.</li> <li>User with Owner permissions for the resource group created.</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.3-Note-of-resources-provisioned-on-this-stage/","title":"2.3 Note of resources provisioned on this stage","text":"<p>Next resources will be provisioned: * 3 AAD Apps. Feel free to use your own naming conventions for them. Suggested names:    * [EnvPrefix] eCabinet DevOps    * [EnvPrefix] BMCP Client    * [EnvPrefix] BMCP Server * Azure resources will be created in the azure resource group, specified in pre-requisites. Deployment pipeline uses <code>$solutionName</code> variable to generate names for the resources. <code>$solutionName</code> value should be unique for every environment. All resources provisioned to AustraliaSouthEast azure region.    * \"($solutionName)-CDNp\" - Front Door and CDN profiles    * \"($solutionName)-CDNe\" - Endpoint    * \"($solutionName)sa\"  - Storage account    * \"($solutionName)-KV\" - Key vault    * \"($solutionName)-AI\" - Application Insights    * \"($solutionName)R\" - Azure Cache for Redis    * \"($solutionName)-cdb\" - Azure Cosmos DB account    * \"AustraliaSoutheastPlan\" - App Service plan    * \"($solutionName)-PFAP\" - App Service plan    * \"($solutionName)-PFA\" - Function App    * \"($solutionName)-API\" - API WebApp    * \"($solutionName)-API-AP\" - API WebApp service plan * A set of AAD groups (~20), following a naming convention, with means the same prefix and postfix value for all groups.</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.4-Generate-certificates/","title":"2.4 Generate certificates","text":"<p>Suggested approach to generating a certificate using PnP PowerShell.  See documentation here: https://docs.microsoft.com/en-us/powershell/module/sharepoint-pnp/new-pnpazurecertificate?view=sharepoint-ps</p> <p>Here is the script to generate a certificate:</p> <pre><code>$data = New-PnPAzureCertificate -OutPfx Cert.pfx -OutCert Cert.cer -CommonName \"[Name of the certificate]\" -Country \"au\" -Locality \"vic\" -ValidYears 5 -CertificatePassword (ConvertTo-SecureString -String \"[your password here]\" -AsPlainText -Force)\n$data | ConvertTo-Json | Add-Content -Path ccertdata.json;\n</code></pre> <p>Save pfx, cer and certdata.json files and the certificate password in secure storage. You can generate a certificate in any other way or change any values used for generation, according to your rules or policies.</p> <p>Certificates to generate: 1. A certificate for \"[EnvPrefix] BMCP DevOps\" AAD App. The certificate should have 2 years lifetime. This certificate will be used for authorisation for Azure DevOps provisioning pipelines. Certificate expiration won\u2019t affect the app, only new deployments. 1. A certificate for \"[EnvPrefix] BMCP Server\" AAD App. The certificate should have 5 or 10 years lifetime. This certificate will be used for authorisation for BMCP application. Expiration will affect the application work, it should be re-generated and updated before it expires.</p> <p>As the output, you should have 2 sets of certificate files with passwords.</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.5-Create-AAD-Apps/","title":"2.5 Create AAD Apps","text":"<p>[[TOC]]</p> <p>The following apps should be created in the same Azure tenancy in which the resources will be deployed.</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.5-Create-AAD-Apps/#251-devops-app","title":"2.5.1 DevOps App","text":""},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.5-Create-AAD-Apps/#2511-create-a-new-aad-app","title":"2.5.1.1\u00a0Create a new AAD App","text":"<p>Skip this step if you have [EnvPrefix] eCabinet DevOps app created for Brief Connect for the same environment. Go to next \"update\" section.</p> <p>Create a new AAD app:</p> <ul> <li>Name: [EnvPrefix] eCabinet DevOps</li> <li>Single \u2013 tenant</li> <li>No redirect URI</li> </ul> <p>Update Authentication:</p> <ul> <li>Click \"Authentication\" in the side panel</li> <li>Click \"Add a platform\"</li> <li>Select \"Web\"</li> <li>Redirect URI:\u00a0https://dev.azure.com</li> <li>Check \"ID tokens\"</li> </ul> <p>Create Client Secret:</p> <ul> <li>Click \"Certificates and Secrets\" in the side panel</li> <li>Description: [EnvPrefix] eCabinet DevOps</li> <li>Expires: 24 months</li> <li>Take note of the secret - you'll need it later and it is only displayed now.</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.5-Create-AAD-Apps/#2512-update-the-app","title":"2.5.1.2\u00a0Update the app","text":"<p>Upload Certificate:</p> <ul> <li>Click \"Certificates and Secrets\" in the side panel</li> <li>Upload CER file generated for this app previously</li> </ul> <p>Update Authentication for PnP: * Click \"Authentication\" in the side panel * Click \"Add a platform\" * Select \"Mobile and desktop applications\" * Select \u201chttps://login.microsoftonline.com/common/oauth2/nativeclient\u201d * Custom redirect URIs: http://localhost * Click Configure</p> <p>Update API Permissions:</p> <ul> <li>SharePoint, Application: Sites.Selected, TermStore.ReadWrite.All</li> <li>MS Graph, Delegated: Sites.FullControl.All</li> <li>Grant admin consent for the added permissions</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.5-Create-AAD-Apps/#252-client-app","title":"2.5.2\u00a0Client App","text":"<p>Create a new AAD app registration:</p> <ul> <li>Name: [EnvPrefix] BMCP Client</li> <li>Single \u2013 tenant</li> <li>No redirect URI (note: will provide after resources are provisioned)</li> </ul> <p>Update API Permissions:</p> <ul> <li>Click \"API Permissions\" in the side panel</li> <li>Microsoft Graph, Delegated: email, offline_access, openid, profile, Sites.Read.All</li> <li>These should be the only permissions granted, remove any default permissions (User.Read)</li> <li>Grant admin consent for the added permissions</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.5-Create-AAD-Apps/#253-server-app","title":"2.5.3 Server App","text":"<p>Create a new AAD app registration:</p> <ul> <li>Name: [EnvPrefix] BMCP Server</li> <li>Single - tenant</li> <li>No redirect URI (note: will provide after resources are provisioned)</li> </ul> <p>Upload Certificate:</p> <ul> <li>Click \"Certificates and Secrets\" in the side panel</li> <li>Upload CER file generated for this app previously</li> </ul> <p>Update API Permissions:</p> <ul> <li>Microsoft Graph, Delegated: Group.Read.All, GroupMember.Read.All, Sites.ReadWrite.All, Sites.Read.All, User.Read, User.Read.All</li> <li>Microsoft Graph, Application: Group.Read.All, GroupMember.Read.All, Mail.Send, Sites.Selected, TeamsActivity.Send, User.Read.All</li> <li>SharePoint, Delegated: AllSites.Manage, TermStore.Read.All</li> <li>SharePoint Application: Sites.Read.All, Sites.Selected</li> <li>Grant admin consent for the added permissions</li> </ul> <p>Update Manifest:</p> <ul> <li>Click \"Manifest\" in the side panel</li> <li>Edit \"knownClientApplications\" such that it is an array of 1 string, being the application id of the [ENVPREFIX] BMCP Client App Registration from above (replace nil-Id to real id value): <code>\"knownClientApplications\": [\"00000000-0000-0000-0000-000000000000\"],</code></li> <li>Edit \"requestedAaccessTokenVersion\", setting its value to: 2: <code>\"requestedAaccessTokenVersion\": 2,</code> <p></p> </li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.6-Assign-permissions/","title":"2.6 Assign permissions","text":"<ol> <li>Add Contributor role assignment for \u201c[EnvPrefix] BriefConnect DevOps\u201d AAD app to the Azure Resource group for the related environment.</li> <li>Add Read role assignment for \u201c[EnvPrefix] BriefConnect DevOps\u201d AAD for the subscription, associated with the resource group. This role assignment can be deleted after a service connection is created in Azure DevOps</li> </ol> <p>Steps to add a role assignment for any given resource: * Open a target resource in Azure Portal. * Go to Access Control \u2013 Role assignments. * Click on \u201cAdd\u201d button, select \u201cAdd role assignment\u201d. * Pick a role, click Next. * Select \u201cAssign access to\u201d, and in \u201cMembers\u201d select [EnvPrefix] BriefConnect DevOps app * Save the assignment.</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.7-Create-a-service-connection-in-Azure-DevOps/","title":"2.7 Create a service connection in Azure DevOps","text":"<ul> <li>Subscription ID and name</li> <li>[EnvPrefix] eCabinet DevOps app ID and Secret</li> <li>Tenant ID</li> </ul> <p>Create a service connection:</p> <ul> <li>Open the project in Azure DevOps. Navigate to Project Settings \u2013 Service connections</li> <li>Click 'New service connection\u2019.</li> <li>Select 'Azure Resource Manager', click \u201cNext\u201d.</li> <li>Select 'Service principal (manual)', click \u201cNext\u201d.</li> <li>Provide the Subscription ID an Subscription Name of subscription in which the target resource group is located</li> <li>Provide the DevOps App Registration App ID as the Service Principal Id</li> <li>Provide the DevOps App Registration client secret as the Service Principal Key</li> <li>Provide the Tenant ID of the tenant.</li> <li>Validate the connection.</li> <li>Provide a name and description ([EnvPrefix] BMCP Azure Resources)</li> <li>Save</li> </ul> <p>Upload a certificate * Open the project in Azure DevOps. Navigate to Pipelines - Library in the left navigation panel * Open \u201cSecure files\u201d tab * Upload PFX file there</p> <p>When the service connection in place, you can delete \u201cReader\u201d role assignment on the subscription level, created above in step 1 of this section.</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.8-Pipeline-Configuration/","title":"2.8 Pipeline Configuration","text":"<p>[[TOC]]</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.8-Pipeline-Configuration/#281-set-up-and-run-build-pipeline","title":"2.8.1\u00a0Set-up and run Build Pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines in the left-hand navigation menu.</li> <li>Click on \u201cNew pipeline\u201d button at the top.</li> <li>Select \u201cAzure Repos Git (YAML)\u201d on the \u201cConnect\u201d tab.</li> <li>Select \u201c\u2026 Azure Resources\u201d repository on the \u201cSelect\u201d tab.</li> <li>Select \u201cExisting Azure Pipelines YAML file\u201d on the \u201cConfigure\u201d tab.</li> <li>Set \u201c/pipeline/build-pipeline.yml\u201d value in the existing YAML file path</li> <li>Click on \u201cRun\u201d button on the \u201cReview\u201d tab step. Wait the build run until it is completed.</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.8-Pipeline-Configuration/#282-set-up-and-run-release-pipeline","title":"2.8.2 Set-up and run Release Pipeline","text":""},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.8-Pipeline-Configuration/#2821-createupdate-release-pipeline","title":"2.8.2.1\u00a0Create/update release pipeline","text":"<p>If this is the very first environment, then the release pipeline doesn\u2019t exist, so you need to go to the next step. If it is not the first environment provisioning, then skip \u201cCreate\u201d step and go to the \u201cUpdate release pipeline\u201d step</p>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.8-Pipeline-Configuration/#28211-create-release-pipeline","title":"2.8.2.1.1\u00a0Create release pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Releases in the left hand navigation menu. Click on \u201cNew\u201d \u2013 \u201cNew release pipeline\u201d button.</li> <li>Do not select a Stage template in the right panel, just close it.</li> <li>Name in \u201cDeploy BMCP Azure Resources\u201d.</li> <li>Add an Artifact sourced from \u201c\u2026 Azure Resources\u201d build pipeline created earlier.</li> <li>Save it.</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.8-Pipeline-Configuration/#28212-update-release-pipeline","title":"2.8.2.1.2 Update release pipeline.","text":"<ul> <li>Open \u201cDeploy BMCP Azure Resources\u201d release pipeline. Click on \u201cEdit\u201d button.</li> <li>In Stages section add a new Stage, select \u201cEmpty job\u201d template.</li> <li>Open stage tasks.</li> <li>Name the stage with the environment name.</li> <li>In the Agent job properties select any appropriate Windows hosted agent pool.</li> <li> <p>Add new task. Select \u201cExtract files\u201d task template.</p> <p></p> </li> <li> <p>Set properties to:</p> </li> <li>Display name: Extract files</li> <li>Archive file patterns: $(System.ArtifactsDirectory)/**/*-scripts.zip</li> <li>Destination folder: $(System.DefaultWorkingDirectory)/extracted/</li> <li> <p>Clean destination folder before extracting: checked</p> <p></p> </li> <li> <p>Add new task. Select \u201cAzure CLI\u201d task template. Set props to:</p> </li> <li>Display name: Deploy Azure Resources</li> <li>Deploy Azure Resources: select previously created service connector</li> <li>Script Type: PowerShell</li> <li>Script Location: Script path</li> <li>Script Path: <code>$(System.DefaultWorkingDirectory)/extracted/DeployAbcAzureResources.ps1</code></li> <li>Script Arguments: <code>-subscriptionId $(az.subscriptionId) -solutionName $(az.solutionName) -tenantId $(az.tenantId) -serverAppClientId $(serverAppClientId) -resourceGroupName $(resourceGroupName)</code></li> <li>ErrorActionPreference: Stop</li> <li> <p>Access service principal details in script: checked</p> <p></p> </li> <li> <p>Go to Variables tab, and add new variables for the newly created stage Scope:</p> </li> <li><code>az.subscriptionId</code> \u2013 Azure subscription ID related to the target azure resource group</li> <li><code>az.solutionName</code> \u2013 the base name of the resources. See 2.3 of this instruction. Must be unique, 20 or less alphanumeric characters (a-z, A-Z, 0-9)</li> <li><code>az.tenantId</code> \u2013 ID of the tenant (GUID)</li> <li><code>serverAppClientId</code> \u2013 id of the AAD Server App created previously.</li> <li><code>resourceGroupName</code> \u2013 target azure resource group</li> </ul>"},{"location":"Deployment%20Guide/Home/2.-Azure-Resource-Deployment/2.9-Initial-Deployment-%252D-Kick%252Doff-Pipelines/","title":"2.9 Initial Deployment %2D Kick%2Doff Pipelines","text":"<p>Run the new release pipeline (stage).</p>"},{"location":"Deployment%20Guide/Home/3-Add-application-permissions-on-sites/3.1-Pre%252Drequisites/","title":"3.1 Pre%2Drequisites","text":"<ul> <li>PnP.Powershell module is installed</li> <li>AAD Service Principal configured and permissions set with admin consent (see 2.5.1.2 of this deployment guide)</li> <li>User with Site Collection administrator access to BMCP Site collection</li> </ul>"},{"location":"Deployment%20Guide/Home/3-Add-application-permissions-on-sites/3.2-Steps/","title":"3.2 Steps","text":"<p>BMCP app requires access to BriefConnect sites with application context. Use next instruction to add permissions to a site collection.</p> <ol> <li>Open PowerShell</li> <li>Move to folder with <code>GrantAppOnlyPermissions.ps1</code> script from \"Brief Connect - Azure Resources\" repository</li> <li>Run command <code>.\\GrantAppOnlyPermissions.ps1 -appClientId {client id} -siteUrl {site url} -fullControl $true/$false</code>. It will show popup window with login request. Use an account with SiteCollection Administrator access level on the target site<ol> <li>{client id} - AAD application id of the app which requires those permissions</li> <li>{site url} - he url of the target site, where permissions should be added</li> <li>fullControl - variable with <code>$false</code> value, if only Write permission level required. Leave it <code>$true</code> for FullControl</li> </ol> </li> <li>Wait the execution of the script.</li> </ol>"},{"location":"Deployment%20Guide/Home/3-Add-application-permissions-on-sites/3.3-Sites-and-applications/","title":"3.3 Sites and applications","text":"<p>Here is the list of sites and the apps with desired access level in form [site] \u2013 [app] - [permission level]  1. BMCP Site \u2013 BMCP Server AAD App \u2013 FullControl 2. BMCP Site \u2013 BMCP DevOps AAD App \u2013 FullControl</p>"},{"location":"Deployment%20Guide/Home/4-Setup-email-notifications-whitelist-%28optional%29/4.1-Pre%252Drequisites/","title":"4.1 Pre%2Drequisites","text":"<ul> <li>Exchange administrator account</li> <li>Name of the BMCP service account that is used to send notifications</li> <li>The actual list of users to add in the whitelist</li> </ul>"},{"location":"Deployment%20Guide/Home/4-Setup-email-notifications-whitelist-%28optional%29/4.2-Steps/","title":"4.2 Steps","text":"<ol> <li>Using the Exchange Administrator account go to Mail Flow Rules settings page here: https://admin.exchange.microsoft.com/#/transportrules</li> <li>Click on \"Add a rule\" button and select \"Create a new rule\" option. ![Graphical user interface, text, application </li> <li>Add a new rule and set next options on \"Set rule conditions\" wizard page:</li> <li>Set the name of the rule</li> <li>Apply this rule if | The sender is this person | select the BMCP Service account</li> <li>Do the following | Block the message | Delete the message without notifying anyone<ul> <li>Except if | The recipient | This is the option to add users from the whitelist. Select the option that suits best for you. Here is a rule example for DEV environment  </li> </ul> </li> <li>Click on \"Next\" button. On the \"Set rule settings\" select next options:</li> <li>Rule mode: Enforce</li> <li>Severity: Not Specified</li> <li>Activate/Deactivate this rule on - leave unchecked and disabled</li> <li>Check \"Stop processing more rules\"</li> <li>Leave \"Defer the message if rule processing doesn't complete\" unchecked</li> <li>Match sender address in message: Header or envelope.</li> <li>Click \"Next\", review the rule, and click \"Finish\" then \"Done\" buttons.</li> <li>After the rule is created you need to enable it. Find it in the list of rules and open.</li> <li>Check \"Enable or disable rule\" toggle to \"On\" position. Refresh the page.</li> <li>Confirm the rule has \"Enabled\" status in the list</li> </ol> <p>Wait at least 30 minutes after creating a rule before you test it. If you test immediately after you create the rule, you may get inconsistent behaviour.</p> <p>When the rule is ready and working, make sure notifications enabled in the Azure Function App settings. Notifications should be enabled in the App Settings, as they will be filtered by the rule created above.</p> <p>DisableAllNotifications: false</p> <p>For more details see MS documentation here: https://learn.microsoft.com/en-gb/exchange/security-and-compliance/mail-flow-rules/test-mail-flow-rules</p>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.1-Manual-Pre%252Drequisites/","title":"5.1 Manual Pre%2Drequisites","text":"<p>The following actions must have occurred prior to this deployment:</p> <ul> <li>Site Collection Created (Communication Site)</li> <li>DevOps AAD App has Sites.Selected - Full Control on the Site Collection</li> <li>PnP PowerShell must be registered for use in the tenant (Tenant Admin required):</li> <li>https://pnp.github.io/powershell/articles/authentication.html </li> </ul>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.2-SharePoint-Site-Manual-Configuration/","title":"5.2 SharePoint Site Manual Configuration","text":"<ul> <li>Add all users BMCP AAD group to the site visitors group (this includes internal and GUEST users)</li> <li>Add admins BMCP AAD group to the site collection administrators</li> <li>Add users who can edit the site configuration (e.g. document templates, proxy users, etc) to the site members group (for non-admins)</li> <li>If there are users who should only have partial edit rights (e.g. can edit proxy users list, but not document templates) then the permissions hierarchy must be broken at the list level. If this occurs the read access from the site must be maintained at each list.</li> </ul>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.3-Build-Pipeline/","title":"5.3 Build Pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Pipelines in the left hand navigation menu.</li> <li>Create a new pipeline, connect it to Azure Repos Git, Select \u201cBMCP Office Resources\u201d repository</li> <li>Select the build-pipelines.yml file in \u201cBMCP Office Resources\u201d repository.</li> </ul>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.4-Release-Pipeline/","title":"5.4 Release Pipeline","text":"<p>[[TOC]]</p>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.4-Release-Pipeline/#541-createupdate-release-pipeline","title":"5.4.1 Create/update release pipeline","text":"<p>If this is the very first environment, then the release pipeline doesn\u2019t exist, so you need to go to the next step. If it is not the first environment provisioning, then clone an existing stage, skip \u201cCreate\u201d step and go to the \u201cUpdate release pipeline\u201d step.</p>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.4-Release-Pipeline/#542-create-release-pipeline","title":"5.4.2\u00a0Create release pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Releases in the left hand navigation menu. Click on \u201cNew\u201d \u2013 \u201cNew release pipeline\u201d button.</li> <li>Do not select a Stage template in the right panel, just close it.</li> <li>Name in \u201cDeploy Office Resources\u201d.</li> <li>Add an Artifact sourced from \u201c\u2026 Office Resources\u201d build pipeline created earlier.</li> <li>Save it.</li> </ul>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.4-Release-Pipeline/#543-upload-a-certificate","title":"5.4.3\u00a0Upload a certificate","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Library in the left hand navigation menu. Switch to Secure files tab and click on \u201c+ Secure file\u201d button. </li> <li>Upload a pfx certificate file for DevOps AAD Application</li> </ul>"},{"location":"Deployment%20Guide/Home/5-Deploy-Office-Resources/5.4-Release-Pipeline/#544-update-release-pipeline","title":"5.4.4 Update release pipeline.","text":"<ul> <li>Open \u201cDeploy Office Resources\u201d release pipeline. Click on \u201cEdit\u201d button.</li> <li>In Stages section clone an existing stage or add a new Stage with selecting \u201cEmpty job\u201d template.</li> <li>Open stage tasks.</li> <li>Name the stage with the environment name.</li> <li>In the Agent job properties select any appropriate Windows hosted agent pool. </li> <li>Add new task. Select \u201cDownload secure file\u201d task template.</li> <li>Set properties to:</li> <li>Display name: Download AAD app cert</li> <li>Secure File: Select pfx file for the current environment</li> <li>Output Variables - Reference name: DevOpsProvisioningCert</li> <li>Add new task. Select \u201cPowershell\u201d task template. Set props to:</li> <li>Display name: Install PnP.PowerShell modules</li> <li>Type: File Path</li> <li>Script Path: <code>$(System.DefaultWorkingDirectory)/extracted/InstallModules.ps1</code> Script Arguments: empty</li> <li>Select Advanced \u2013 User PowerShell Core</li> <li>Add new task. Select \u201cPowershell\u201d task template. Set props to:</li> <li>Display name: Deploy Office Resources</li> <li>Type: File Path</li> <li>Script Path: <code>$(System.DefaultWorkingDirectory)/extracted/DeployAbcOfficeResources.ps1</code></li> <li>Script Arguments: <code>-siteUrl $(sp.siteurl) -tenantId $(tenantId) -clientId $(appClientId) -certPath $(DevOpsProvisioningCert.secureFilePath) -password (ConvertTo-SecureString '$(certPassword)' -AsPlainText -Force)</code></li> <li> <p>Select Advanced \u2013 User PowerShell Core</p> <p> </p> </li> <li> <p>Go to Variables tab, and add new variables for the newly created stage Scope:</p> </li> <li>appClientId \u2013 DevOps AAD App ID</li> <li>certPassword \u2013 password for the certificate file</li> <li>sp.siteurl \u2013 site collection url</li> <li>sp.username \u2013 service account user name</li> <li>tenantId \u2013 ID of the tenant where the site collection is hosted <p></p> </li> </ul>"},{"location":"Deployment%20Guide/Home/6-Deploy-Server%252DSide-Code/6.1-Build-Pipeline/","title":"6.1 Build Pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Pipelines in the left hand navigation menu.</li> <li>Create a new pipeline, connect it to Azure Repos Git, Select \u201c\u2026 Server\u201d repository</li> <li>Select the azure-pipelines.yml file in \u201c\u2026\u00a0 Server\u201d repository.</li> <li>Name it \u201cRelease - BMCP Server</li> </ul>"},{"location":"Deployment%20Guide/Home/6-Deploy-Server%252DSide-Code/6.2-Release-Pipeline/","title":"6.2 Release Pipeline","text":""},{"location":"Deployment%20Guide/Home/6-Deploy-Server%252DSide-Code/6.2-Release-Pipeline/#6211-createupdate-release-pipeline","title":"6.2.1.1 Create/update release pipeline","text":"<p>If this is the very first environment, then the release pipeline doesn\u2019t exist, so you need to go to the next step. If it is not the first environment provisioning, then skip \u201cCreate\u201d step and go to the \u201cUpdate release pipeline\u201d step</p>"},{"location":"Deployment%20Guide/Home/6-Deploy-Server%252DSide-Code/6.2-Release-Pipeline/#62111-create-release-pipeline","title":"6.2.1.1.1 Create release pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Releases in the left hand navigation menu. Click on \u201cNew\u201d \u2013 \u201cNew release pipeline\u201d button.</li> <li>Do not select a Stage template in the right panel, just close it.</li> <li>Name in \u201cDeploy Server\u201d.</li> <li>Add an Artifact sourced from \u201c\u2026 Server\u201d build pipeline created earlier.</li> <li>Save it.</li> </ul>"},{"location":"Deployment%20Guide/Home/6-Deploy-Server%252DSide-Code/6.2-Release-Pipeline/#62112-update-release-pipeline","title":"6.2.1.1.2 Update release pipeline.","text":"<ul> <li>Open \u201cDeploy Server\u201d release pipeline. Click on \u201cEdit\u201d button.</li> <li>In Stages section add a new Stage, select \u201cEmpty job\u201d template.</li> <li>Open stage tasks.</li> <li>Name the stage with the environment name.</li> <li>In the Agent job properties select any appropriate Windows hosted agent pool. </li> <li>Add new task. Select \u201cAzure Functions Deploy\u201d task template.</li> <li>Set properties to:</li> <li>Display name: Azure Function App</li> <li>Azure Resource Manager connection: select a service connection for the specific environment</li> <li>App type: Function App on Windows</li> <li>Azure Functions App name: ***-PFA function</li> <li>Package or folder: $(System.ArtifactsDirectory)/**/*-release.zip </li> <li>Add new task. Select \"Azure Web App Deploy\" task template.</li> <li>Set properties to:</li> <li>Display name: Azure Web App Deploy</li> <li>Azure Resource Manager connection: select a service connection for the specific environment</li> <li>App type: Web App on Windows</li> <li>Azure Functions App name: ***-API</li> <li>Package or folder: <code>$(System.ArtifactsDirectory)/**/*-api-release.zip</code> </li> </ul>"},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/7.1-Build-Pipeline/","title":"7.1 Build Pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Pipelines</li> <li>Create pipeline from existing YAML file</li> <li>Select the pipeline/build-pipeline.yml file in \u201cBMCP Client\u201d repository.</li> <li>Save it with \u201cRelease \u2013 BMCP Client\u201d</li> </ul>"},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/7.2-Client-Configuration-JSON/","title":"7.2 Client Configuration JSON","text":"<p>A new environment will require that a client configuration json file is provisioned such that the client application knows which backend to authenticate to and to send request to. * The value should be a valid JSON with next format:</p> <pre><code>{\n    \"tenantId\": \"[tenant ID]\",\n    \"clientId\": \"[client AAD app id]\",\n    \"apiScope\": \"api://[cdn endpoint name part]-cdne.azureedge.net/[server AAD app id]/access_as_user\",\n    \"baseUrl\": \"[PFA azure function url]\"\n}\n\n</code></pre> <ul> <li>Use this value for the config json variable on the next step.</li> </ul>"},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/7.3-Release-Pipeline/","title":"7.3 Release Pipeline","text":""},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/7.3-Release-Pipeline/#7311-createupdate-release-pipeline","title":"7.3.1.1 Create/update release pipeline","text":"<p>If this is the very first environment, then the release pipeline doesn\u2019t exist, so you need to go to the next step. If it is not the first environment provisioning, then skip \u201cCreate\u201d step and go to the \u201cUpdate release pipeline\u201d step</p>"},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/7.3-Release-Pipeline/#73111-create-release-pipeline","title":"7.3.1.1.1 Create release pipeline","text":"<ul> <li>Open the project in Azure DevOps, go to Pipelines - Releases in the left hand navigation menu. Click on \u201cNew\u201d \u2013 \u201cNew release pipeline\u201d button.</li> <li>Do not select a Stage template in the right panel, just close it.</li> <li>Name in \u201cDeploy BMCP Client\u201d.</li> <li>Add an Artifact sourced from \u201cRelease \u2013 BMCP Client\u201d build pipeline created earlier.</li> <li>Save it.</li> </ul>"},{"location":"Deployment%20Guide/Home/7-Deploy-Client%252DSide-Code/7.3-Release-Pipeline/#73112-update-release-pipeline","title":"7.3.1.1.2\u00a0 Update release pipeline.","text":"<ul> <li>Open \u201cDeploy Client\u201d release pipeline. Click on \u201cEdit\u201d button.</li> <li>In Stages section add a new Stage, select \u201cEmpty job\u201d template.</li> <li>Open stage tasks.</li> <li>Name the stage with the environment name.</li> <li>In the Agent job properties select any appropriate Windows hosted agent pool.</li> <li>Add new task. Select \u201cExtract files\u201d task template. </li> <li>Set properties to:</li> <li>Display name: Extract files</li> <li>Archive file patterns: $(System.ArtifactsDirectory)/**/*-build.zip</li> <li>Destination folder: $(System.DefaultWorkingDirectory)/web/</li> <li>Clean destination folder before extracting: checked</li> <li>Add new task. Select \u201cExtract files\u201d task template. Set props to:</li> <li>Set properties to:</li> <li>Display name: Extract scripts</li> <li>Archive file patterns: $(System.ArtifactsDirectory)/**/*-release-script.zip</li> <li>Destination folder: $(System.DefaultWorkingDirectory)/extracted/</li> <li>Clean destination folder before extracting: checked</li> <li>Add new task. Select \u201cPowerShell\u201d task template. Set props to:</li> <li>Set properties to:</li> <li>Display name: Create environment config file</li> <li>Type: Inline</li> <li> <p>Script: <code>New-Item -Path \"$(System.DefaultWorkingDirectory)/web/\" -Name \"config.json\" -Value '$(configJSON)' -Force</code></p> <p></p> </li> <li> <p>Add new task. Select \u201cAzure CLI\u201d task template. Set props to:</p> </li> <li>Display name: Deploy static CDN files</li> <li>Azure Resource Manager connection:\u00a0 select a service connection for the specific environment.</li> <li>Script Type: PowerShell</li> <li>Script Location: Script path</li> <li>Script Path: <code>$(System.DefaultWorkingDirectory)/extracted/release-pipeline.ps1</code></li> <li>Script Arguments: <code>-storageAccountName $(storageAccountName) -resourceGroupName $(resourceGroupName) -cdnEndpointName $(cdnEndpointName) -cdnProfileName $(cdnProfileName) -workingDirectory $(System.DefaultWorkingDirectory)</code></li> <li> <p>ErrorActionPreference: Stop</p> <p></p> </li> <li> <p>Go to Variables tab, and add new variables for the newly created stage Scope:</p> </li> <li>cdnEndpointName \u2013 CDN endpoint name (xxxx-CDNe)</li> <li>cdnProfileName \u2013 CDN profile name (xxxx-CDNp)</li> <li>resourceGroupName \u2013 azure rersource group name</li> <li>storageAccountName \u2013 storage account name</li> <li>configJSON \u2013 JSON value from \u201cClient Configuration JSON\u201d section</li> </ul> <p></p>"},{"location":"Deployment%20Guide/Home/8-Teams-Application/8.1-Pre%252Drequisites/","title":"8.1 Pre%2Drequisites","text":"<ul> <li>Teams administrator account</li> </ul>"},{"location":"Deployment%20Guide/Home/8-Teams-Application/8.2-Prepare-and-install-Teams-App/","title":"8.2 Prepare and install Teams App","text":"<ul> <li>Open manifest.json file in \u201cteams\u201d folder from \u201c[ENVPREFIX] Client\u201d code repository.</li> <li>Replace the App ID guid with a unique generated for the current environment.\\   To generate a unique App ID guid open powershell and type New-Guid</li> <li>If the app is not the production app, you may want to update the packageName, staticTabs/Name properties, name and description sections to reflect this.</li> <li>Replace\u00a0<code>&lt;&lt;app domain&gt;&gt;</code>\u00a0placeholder to be actual application domain url ( &lt; CDN-ENDPOINT-NAME &gt;.azureedge.net )</li> <li>Replace\u00a0<code>&lt;&lt;sharepoint domain&gt;&gt;</code>\u00a0placeholder to be the SharePoint Tenant name. For help with finding your Tenant name, see instructions\u00a0here\u00a0\u00a0. E.g:\u00a0BMCPtenant.sharepoint.com </li> <li>Replace\u00a0<code>&lt;&lt;AAD Server App ID&gt;&gt;</code>\u00a0placeholder to be id of the AAD Server App</li> <li>Add app icons to the same folder with manifest file. See https://learn.microsoft.com/en-us/microsoftteams/platform/resources/schema/manifest-schema Icons section for more details.</li> <li>Create a ZIP package with the manifest.json, color.png, and outline.png files. The two image files are the icons for your app in Teams.</li> <li>Name this package App.zip (for example).</li> <li>Make sure that the 3 files are the top level of the ZIP package, with no nested folders.</li> <li>Upload and publish\u00a0\u00a0App.zip to your tenant's app catalog so that it is available for everyone in your tenant to install.</li> </ul>"},{"location":"Deployment%20Guide/Home/8-Teams-Application/8.3-Setup-Teams-policies/","title":"8.3 Setup Teams policies","text":"<p>Setup teams policies to limit a list of users who have access to the teams app, if necessary.</p>"},{"location":"Deployment%20Guide/Home/8-Teams-Application/8.4-Update-Azure-Function-Settings/","title":"8.4 Update Azure Function Settings","text":"<p>For PFA Function App and for API Web App</p> <ul> <li>Click 'Environment variables' in the side panel</li> <li>Create a 'New' for each of the following, or update existing:</li> <li>TeamsAppId: Id of the teams app after installation. You can find it in Teams Admin center, in the browser url, when the app is opened: </li> </ul>"},{"location":"Solution%20Design/","title":"Index","text":"<p>Hello world!</p>"},{"location":"User%20Guide/Add-attachments/","title":"Add attachments","text":"<p>Users can attach documents both during record creation and when modifying existing records.</p> <p>There are three categories to which users can attach documents:</p> <ul> <li>Attachments</li> <li>Primary Documentation</li> <li>Supporting Documentation.</li> </ul> <p>To upload documents when creating a new record, users must go to the step 'Add templates and documents', scroll down to the appropriate section, press the 'Select file' dropdown, and choose whether to select a file from their drive or SharePoint Online. </p> <p>To upload a document when modifying a record, users must navigate to the 'Documents' tab and press the 'Add or remove documents' button. </p> <p>Depending on their needs, they should press the 'Select file' dropdown under the appropriate heading and choose whether to select a file from their drive or SharePoint Online.</p>"},{"location":"User%20Guide/Add-attachments/#sharepoint-online-file-limitations","title":"SharePoint Online File Limitations","text":"<p>When attaching files to records the files are stored in SharePoint Online. Please note the following SharePoint Online limitations:</p>"},{"location":"User%20Guide/Add-attachments/#file-size-limits","title":"File Size Limits","text":"<ul> <li>Individual file size limit: 250 GB</li> <li>Recommended upload size for optimal performance: Less than 100 GB</li> </ul>"},{"location":"User%20Guide/Add-attachments/#supported-file-types","title":"Supported File Types","text":"<p>SharePoint Online supports most file types, including but not limited to: - Documents (DOC, DOCX, PDF, XLS, XLSX, PPT, PPTX) - Images (JPG, JPEG, PNG, GIF) - Video files (MP4, MOV) - Audio files (MP3, WAV)</p>"},{"location":"User%20Guide/Add-attachments/#restricted-file-types","title":"Restricted File Types","text":"<p>The following file types are blocked for security reasons: - Executable files (.exe, .com, .bat, .cmd) - Script files (.js, .vbs) - Database files (.mdb)</p>"},{"location":"User%20Guide/Add-attachments/#file-and-folder-name-restrictions","title":"File and Folder Name Restrictions","text":"<ul> <li>Cannot use: \" * : &lt; &gt; ? / \\ |</li> <li>Names cannot begin or end with a period (.)</li> <li>Maximum file path length: 400 characters</li> <li>Maximum file name length: 260 characters</li> </ul> <p>For more detailed information, please refer to Microsoft's official documentation on SharePoint limitations.</p>"},{"location":"User%20Guide/Exporting-records-to-PDF-or-CSV/","title":"Exporting records to PDF or CSV","text":"<p>Users can export records they have access to from the Brief Connect Dashboard. The supported export formats are PDF and CSV. </p>"},{"location":"User%20Guide/Exporting-records-to-PDF-or-CSV/#exporting-records-to-pdf","title":"Exporting Records to PDF","text":"<ul> <li>Select the record(s) you want to export.</li> <li>Press 'Export selected records as PDF'.</li> <li>Confirm by pressing the 'Submit' button.</li> <li>The generated file will be emailed to your email address within a few minutes.</li> </ul>"},{"location":"User%20Guide/Exporting-records-to-PDF-or-CSV/#exporting-records-to-csv","title":"Exporting Records to CSV","text":"<ul> <li>Select the record(s) you want to export.</li> <li>Press 'Export selected records as Excel'.</li> <li>Select the columns you want to include in your export.</li> <li>Press the 'Generate file' button.</li> <li>Wait until you see the 'Open file' button.</li> <li>Press the 'Open file' button.</li> </ul>"},{"location":"User%20Guide/Flow-Controls/","title":"Flow Controls","text":""},{"location":"User%20Guide/Flow-Controls/#place-a-record-on-hold","title":"Place a record on hold","text":"<p>Click I want to button &gt; Mark as \u2018On hold\u2019. Enter the reason why the record is being put on hold and click Save.</p> <p>Ensure you update the record\u2019s due dates so it\u2019s not incorrectly listed as overdue. </p> <p></p>"},{"location":"User%20Guide/Flow-Controls/#release-a-record-from-hold","title":"Release a record from hold","text":"<p>To release a record that is on hold, click I want to &gt; Release from hold.   </p>"},{"location":"User%20Guide/Flow-Controls/#mark-as-no-further-action","title":"Mark as \u2018No further action\u2019","text":"<p>Records that have progress past the initiate stage but are no longer needed can be marked as \u2018No further action\u2019. This will permanently close the record.</p> <p>To mark a record as \u2018No further action\u2019, click I want to &gt; Mark as \u2018No further action\u2019.  </p>"},{"location":"User%20Guide/Initiate-new-record/","title":"Initiate new record","text":"<p>The \u2018initiator\u2019 is the person who creates a new record in ABC then sends the record to other people for action.</p> <p>Records are initiated from within a user's dashboard screen by selecting the  button.</p> <p>Upon selecting new record button, the initiator will be required to follow several steps to create their record. Although there are different record types that can be created by the initiator, the steps and data fields presented to the initiator will remain similar across different record types and sub types. </p> <p>Some tips for navigating initiating a record are: - When initiating a document all mandatory fields and all relevant optional fields need to be completed. - Mandatory fields are marked with * - When moving though the initiation process users can select next or back to move through stages and make amendments. - If all mandatory fields are not completed, the next button will remain greyed out. - Once all mandatory fields are completed, the next button will turn blue. - There will be different field types. - Some dropdown fields only allow the selection of one item whereas others enable multiple options. - When tick boxes are visible in drop down fields, this means multiple options can be selected.</p>"},{"location":"User%20Guide/Personal-Notification-settings/","title":"Personal Notification settings","text":""},{"location":"User%20Guide/Personal-Notification-settings/#notifications","title":"Notifications","text":"<p>By default, Brief Connect will send you an email notification for all record activity for every record on which you have a role. You can customise the notification you receive for all records, or just individual records.</p> <p>To change your notification for all records:  - Click Settings cog in the top right menu.  - Under Preferred channel, select if you want to receive the notifications via email or Teams (notifications will appear in your Teams\u2019 activity feed).  - Under Frequency, select what criteria you want to receive notifications for </p> <p> - Scroll down and click Save. </p>"},{"location":"User%20Guide/Personal-Notification-settings/#you-can-set-up-different-settings-for-you-proxy-notifications","title":"You can set up different settings for you proxy notifications.","text":""},{"location":"User%20Guide/Personal-Notification-settings/#notifications-for-individual-records","title":"Notifications for individual records","text":"<ul> <li>You can customise notifications for individual records by opening the record and selecting notifications under the Notifications tab.</li> </ul>"},{"location":"User%20Guide/Proxy-management/","title":"Proxy management","text":""},{"location":"User%20Guide/Proxy-management/#what-is-a-proxy","title":"What is a proxy?","text":"<p>A Proxy actions tasks on behalf of a related role/person. Proxies have the same access and permissions as their related role/person and will receive a copy of their notifications. </p>"},{"location":"User%20Guide/Proxy-management/#who-should-use-a-proxy","title":"Who should use a Proxy?","text":"<p>Proxies will commonly be used by Ministers, however all staff are able to use this feature to facilitate flexible working, such as job-sharing arrangements.  It\u2019s important that anyone requesting a proxy understands that proxies can act on their behalf and have access to all records they have access to.  </p> <ul> <li>It\u2019s important that anyone requesting a proxy understands that proxies can act on their behalf and have access to all records they have access to. </li> <li>Once a proxy is allocated their end date can be amended or they can be completely removed through \u201cmanage proxy settings\u201d under the settings cog.</li> <li>Proxy access is not inherited (e.g. your Proxy cannot access the records of anyone to whom you are Proxy). </li> <li>Roles can have more than one Proxy, and proxies can have more than one related role. </li> </ul> <p>Example of how to select whether to view dashboard as yourself or your related person. All users/roles who you are a proxy for will appear in list format. </p>"},{"location":"User%20Guide/Proxy-management/#assign-a-proxy","title":"Assign a proxy","text":"<p>Only the person requesting a Proxy can submit a request (it cannot be done on behalf of someone). </p> <ul> <li>Click Settings cog in the top right corner of the dashboard screen</li> <li>Scroll down to Manage Proxy Access and click Open request template. This will open a populated email template. </li> </ul> <p> - Enter the name of the person you want to add as your Proxy where is says [user] and the date you want their Proxy access to end.  - You may need to add the email into the To field xxx@microsoft.com - Click Send. - Your request will be sent to Brief Connect Administrators via email to action. You\u2019ll be notified once it\u2019s complete. </p>"},{"location":"User%20Guide/Proxy-management/#act-as-a-proxy","title":"Act as a proxy","text":"<p>Once a proxy is assigned their dashboard view will include a new feature called view dashboard for. </p> <p>To switch between profiles: - Click the drop-down arrow under View dashboard for - From the list select the desired role / person</p> <p> - The dashboard will change views and field updated. This is often most apparent in the snapshot numbers. - Perform activities as required. Once complete return to \u2018view dashboard for\u2019 box and amend the selection</p>"},{"location":"User%20Guide/Record-a-decision/","title":"Record a decision","text":"<p>Decision Makers can record a decision based on the provided information, documentation, and recommendations.</p> <p>To record a decision, users must click the 'I want to' dropdown and select 'Record a decision'. </p> <p>Under 'Recommendations', users must select the decision against each recommendation.</p> <p></p> <p>Once a decision is selected, users can provide a comment before pressing the 'Confirm' button.</p>"}]}